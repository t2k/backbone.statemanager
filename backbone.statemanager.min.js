(function(){!function(a,b){var c,d;"function"==typeof define&&define.amd?define(["underscore","backbone"],function(a,c){return b(a,c)}):"undefined"!=typeof exports?(d=require("underscore"),c=require("backbone"),module.exports=b(d,c)):b(a._,a.Backbone)}(this,function(a,b){"use strict";var c;return c=b.StateManager,b.StateManager=function(a,b){var c,d;return c=function(a,b){return this.options=null!=b?b:{},this.states=new c.States(a),this},c.extend=b.View.extend,a.extend(c.prototype,b.Events,{getCurrentState:function(){return this.currentState},addState:function(a,b){return this.states.add(a,b),this.trigger("add:state",a)},removeState:function(a){return this.states.remove(a),this.trigger("remove:state",a)},initialize:function(a){var b;return null==a&&(a={}),(b=this.states.findInitial())?this.triggerState(b,a):void 0},triggerState:function(b,c){return null==c&&(c={}),b!==this.currentState||c.reEnter?(a.extend(c,{toState:b,fromState:this.currentState}),this.currentState&&this.exitState(c),this.enterState(b,c)):!1},enterState:function(b,c){var d,e,f;return null==c&&(c={}),(d=this.states.find(b))&&a.isFunction(d.enter)?(this.trigger("before:enter:state",b,d,c),"function"==typeof(e=d.findTransition("onBeforeEnterFrom",c.fromState))&&e(c),d.enter(c),"function"==typeof(f=d.findTransition("onEnterFrom",c.fromState))&&f(c),this.trigger("enter:state",b,d,c),this.currentState=b,this):!1},exitState:function(b){var c,d,e;return null==b&&(b={}),(c=this.states.find(this.currentState))&&a.isFunction(c.exit)?(this.trigger("before:exit:state",this.currentState,c,b),"function"==typeof(d=c.findTransition("onBeforeExitTo",b.toState))&&d(b),c.exit(b),"function"==typeof(e=c.findTransition("onExitTo",b.toState))&&e(b),this.trigger("exit:state",this.currentState,c,b),delete this.currentState,this):!1}}),c.States=function(b){return this.states={},b&&a.isObject(b)&&a.each(b,function(a){return function(b,c){return a.add(c,b)}}(this)),this},a.extend(c.States.prototype,{add:function(b,d){return a.isString(b)&&a.isObject(d)?this.states[b]=new c.State(b,d):!1},remove:function(b){return a.isString(b)?delete this.states[b]:!1},find:function(b){return a.isString(b)?a.chain(this.states).find(function(a){return a.matchName(b)}).value():!1},findInitial:function(){var b;return null!=(b=a.find(this.states,function(){return function(a){return a.initial}}(this)))?b.name:void 0}}),c.State=function(b,d){return this.name=b,a.extend(this,d),this.regExpName=c.State._regExpStateConversion(this.name),this},a.extend(c.State.prototype,{matchName:function(a){return this.regExpName.test(a)},findTransition:function(b,d){return this.transitions&&a.isString(d)&&a.isString(b)?a.find(this.transitions,function(){return function(a,e){var f;return 0===e.indexOf(""+b+":")?(e=e.slice((f=e.indexOf(":not:")===b.length)?b.length+5:b.length+1),c.State._regExpStateConversion(e).test(d)!==f):void 0}}(this)):!1}}),c.State._regExpStateConversion=function(a){return a=a.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/:\w+/g,"([^/]+)").replace(/\*\w+/g,"(.*?)"),new RegExp("^"+a+"$")},c.addStateManager=function(c,e){var f,g;return null==e&&(e={}),c||new Error("Target must be defined"),g=a.isFunction(c.states)?c.states():c.states,d(g,c),c.stateManager=f=new b.StateManager(g,e),c.triggerState=function(){return f.triggerState.apply(f,arguments)},c.getCurrentState=function(){return f.getCurrentState()},(e.initialize||a.isUndefined(e.initialize))&&f.initialize(e),delete c.states},d=function(b){var c;return c=a.last(arguments),a.each(b,function(e,f){return a.isFunction(e)?b[f]=a.bind(e,c):a.isObject(e)?b[f]=d(e,c):void 0}),b},c}(a,b),b.StateManager.VERSION="0.5.0",b.StateManager.noConflict=function(){return b.StateManager=c,this},b.StateManager})}).call(this);
//# sourceMappingURL=./backbone.statemanager.min.js.map